<app-side-nav></app-side-nav>
<br />
<br />
<br />
<h3>
  <img class="icons" src="https://image.flaticon.com/icons/svg/2016/2016803.svg" />
  จัดการข้อมูลรถ
</h3>
<ng-template #content let-c="close" let-d="dismiss">
  <div [ngStyle]="{ 'background-color': color }" class="header">
    <h4 class="modal-title" id="modal-basic-title">ข้อมูลรถ</h4>
    <button type="button" class="close" aria-label="Close" (click)="d('Cross click')">
      <span aria-hidden="true">&times;</span>
    </button>
  </div>
  <div class="modal-body">
    <form [formGroup]="formTemplate">
      <div class="text-center">
        <img [src]="imgSrc" width="350px" height="250px" (click)="fileUploader.click()" />
      </div>
      <div class="control">
        <label>Select file to upload</label>
        <input type="file" accept="image/*" class="textBox" #fileUploader formControlName="imageUrl"
          (change)="showPreview($event)" />

        <!-- </div> -->
        <!-- <div class="form-row"> -->
        <label>ทะเบียนรถ</label>
        <input type="text" class="textBox" formControlName="carId" ngModel />
        <label>ประเภทรถ</label>
        <input type="text" class="textBox" formControlName="carType" ngModel />
        <label>รุ่นของรถ</label>
        <input type="text" class="textBox" formControlName="carModel" ngModel />

        <label>วันที่ซื้อ</label>
        <input type="text" class="textBox" formControlName="purchaseDate" ngModel />
        <label>วันที่บำรุงรักษาล่าสุด</label>
        <input type="text" class="textBox" formControlName="lastMaintenance" ngModel />
      </div>
    </form>
  </div>
  <div class="modal-footer">
    <button [ngStyle]="{ 'background-color': color }" type="button" class="btn save" (click)="onSubmit(formTemplate)">
      Save
    </button>
  </div>
</ng-template>
<button class="btn icon plus" (click)="openBill(content)">
  <i class="fas fa-bus"></i> เพิ่มข้อมูลรถ
</button>

<!-- แสดงผล -->

<table class="table table-striped">
  <thead>
    <tr>
      <th scope="col">ทะเบียนรถ</th>
      <th scope="col">ประเภทรถ</th>
      <th scope="col">รุ่น</th>
      <th scope="col">วันที่บำรุงรักษาครั้งล่าสุด</th>
      <th scope="col">วันที่ซื้อ</th>
      <th scope="col">action</th>
    </tr>
  </thead>

  <tbody>
    <tr *ngFor="let data of car">
      <td (click)="openData(con)">
        <!-- dialog ------------------------------------------------------------------------->
        <ng-template #con let-c="close" let-d="dismiss">
          <div [ngStyle]="{ 'background-color': color }" class="header">
            <h4 class="modal-title" id="modal-basic-title">ข้อมูลการจ้าง</h4>
            <button type="button" class="close" aria-label="Close" (click)="d('Cross click')">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <div class="modal-body">
            <div class="text-center">
              <img [src]="data.value.imageUrl" width="350px" height="250px" class="img-fluid"
                (click)="deleteImage(data)" />
              <div *ngIf="!data.value.imageUrl">
                <label>Select file to upload</label>
                <input type="file" accept="image/*" class="textBox" #fileUploader ngModel
                  (change)="showPreview($event)" />
              </div>
            </div>

            <label for="typeahead-basic">ทะเบียนรถ</label>
            <input id="typeahead-basic" type="text" class="textBox" name="carId" ngModel
              [(ngModel)]="data.value.carId" />
            <label for="typeahead-basic">ประเภทรถ</label>
            <input id="typeahead-basic" type="text" class="textBox" name="destination" ngModel
              [(ngModel)]="data.value.carType" />
            <label for="typeahead-basic">รุ่น</label>
            <input id="typeahead-basic" type="text" class="textBox" name="worktype" ngModel
              [(ngModel)]="data.value.carModel" />
            <label for="typeahead-basic">วันที่บำรุงรักษาครั้งล่าสุด</label>
            <input id="typeahead-basic" type="text" class="textBox" name="customerFirstname" ngModel
              [(ngModel)]="data.value.purchaseDate" />
            <label for="typeahead-basic"> วันที่ซื้อ</label>
            <input id="typeahead-basic" type="text" class="textBox" name="workDate" ngModel
              [(ngModel)]="data.value.lastMaintenance" />
          </div>

          <div class="modal-footer">
            <button [ngStyle]="{ 'background-color': color }" type="button" class="btn save"
              (click)="editCarTest(data)">
              Save Test
            </button>
          </div>
        </ng-template>
        {{ data.value.carId }}
      </td>
      <td (click)="openData(con)">{{ data.value.carType }}</td>
      <td (click)="openData(con)">{{ data.value.carModel }}</td>
      <td (click)="openData(con)">{{ data.value.purchaseDate }}</td>
      <td (click)="openData(con)">{{ data.value.lastMaintenance }}</td>
      <td>
        <!-- edit----------------------------------------------------------------------------------------->
        <ng-template #content let-c="close" let-d="dismiss">
          <div [ngStyle]="{ 'background-color': color }" class="header">
            <h4 class="modal-title" id="modal-basic-title">
              กรุณากรอกบิลใบเสร็จ
            </h4>
            <button type="button" class="close" aria-label="Close" (click)="d('Cross click')"
              (click)="checkImageFalse()">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <div class="modal-body">
            <form [formGroup]="editimageUrl">
              <div class="text-center">
                <img [src]="data.value.imageUrl" width="350px" height="250px" (click)="openDeleteImage(deleteImg)"
                  *ngIf="checkImageUrl" />
                <div *ngIf="!checkImageUrl">
                  <img [src]="imgSrc" width="350px" height="250px" />
                  <label>Select file to upload</label>
                  <input type="file" accept="image/*" class="textBox" #fileUploader formControlName="imageUrl"
                    (change)="showPreview($event)" />
                  <button (click)="uploadimage(editimageUrl, data)">
                    Upload
                  </button>
                </div>
              </div>
            </form>

            <form [formGroup]="editFormTemplate">
              <div class="card-body">
                <label for="typeahead-basic">ทะเบียนรถ</label>
                <input id="typeahead-basic" type="text" class="textBox" formControlName="carId"
                  [(ngModel)]="data.value.carId" />
                <label for="typeahead-basic">ประเภทรถ</label>
                <input id="typeahead-basic" type="text" class="textBox" formControlName="carType"
                  [(ngModel)]="data.value.carType" />
                <label for="typeahead-basic">รุ่น</label>
                <input id="typeahead-basic" type="text" class="textBox" formControlName="carModel"
                  [(ngModel)]="data.value.carModel" />
                <label for="typeahead-basic">วันที่บำรุงรักษาครั้งล่าสุด</label>
                <input id="typeahead-basic" type="text" class="textBox" formControlName="purchaseDate"
                  [(ngModel)]="data.value.purchaseDate" />
                <label for="typeahead-basic"> วันที่ซื้อ</label>
                <input id="typeahead-basic" type="text" class="textBox" formControlName="lastMaintenance"
                  [(ngModel)]="data.value.lastMaintenance" />
              </div>
            </form>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn save" (click)="editCar(editFormTemplate, data)"
              [ngStyle]="{ 'background-color': color }">
              Save
            </button>
          </div>
        </ng-template>

        <!-- dialog delete image -->
        <ng-template #deleteImg let-c="close" let-d="dismiss">
          <div class="modal-header">
            <h5 class="modal-title" id="modal-basic-title">
              ต้องการลบหรือไม่?
            </h5>

            <button type="button" class="close" aria-label="Close" (click)="d('Cross click')">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <div class="text-center">
            <div class="modal-footer">
              <button type="button" class="btn  save" (click)="deleteImage(data)" (click)="d('Cross click')">
                Yes
              </button>
              <button type="button" class="btn  save" (click)="d('Cross click')">
                No
              </button>
            </div>
          </div>
        </ng-template>

        <button class="btn icon" (click)="openEditCar(content)">
          <i class="far fa-edit"></i>
        </button>
        <button (click)="delete(data)">Delete</button>
        <!-- --------------------------------------------------------------------------------- -->
      </td>
    </tr>
  </tbody>
</table>